---
title: python 实用模块收集
date: 2022-02-18 14:24:34
tags:
- python
categories:
- 编程
- python
---

这篇文章是将自己在浏览源码的时候见到的一起模块收集起来备忘。

## inspect **检查现场对象**

- [快速上手](https://blog.csdn.net/NeverLate_gogogo/article/details/107752428)

inspect 模块也被称为 检查现场对象。这里的重点在于 “现场” 二字，也就是当前运行的状态。
inspect 模块提供了一些函数来了解现场对象，包括 模块、类、实例、函数和方法。
inspect 函数主要用于以下四个方面: 
1. 对是否是模块、框架、函数进行类型检查
2. 获取源码
3. 获取类或者函数的参数信息
4. 解析堆栈

## mock **虚假值测试**
用于测试的模块pytest-mock，将方法屏蔽掉并给出虚假的返回值。

## schema **验证输入**

- [快速上手](https://segmentfault.com/a/1190000011777230)

不管我们做什么应用，只要和用户输入打交道，就有一个原则 -- 永远不要相信用户的输入数据。意味着我们要对用户输入进行严格的验证，web 开发时一般输入数据都以 JSON 形式发送到后端 API，API 要对输入数据做验证。一般我都是加很多判断，各种if，导致代码很丑陋，能不能有一种方式比较优雅的验证用户数据呢？Schema就派上用场了。

## eviron-config **设置和获取变量**

- [快速上手](https://github.com/hynek/environ-config)

```py
>>> import environ
>>> # Extracts secrets from Vault-via-envconsul: 'secret/your-app':
>>> vault = environ.secrets.VaultEnvSecrets(vault_prefix="SECRET_YOUR_APP")
>>> @environ.config(prefix="APP")
... class AppConfig:
...    @environ.config
...    class DB:
...        name = environ.var("default_db")
...        host = environ.var("default.host")
...        port = environ.var(5432, converter=int)  # Use attrs's converters and validators!
...        user = environ.var("default_user")
...        password = vault.secret()
...
...    env = environ.var()
...    lang = environ.var(name="LANG")  # It's possible to overwrite the names of variables.
...    db = environ.group(DB)
...    awesome = environ.bool_var()
>>> cfg = environ.to_config(
...     AppConfig,
...     environ={
...         "APP_ENV": "dev",
...         "APP_DB_HOST": "localhost",
...         "LANG": "C",
...         "APP_AWESOME": "yes",  # true and 1 work too, everything else is False
...         # Vault-via-envconsul-style var name:
...         "SECRET_YOUR_APP_DB_PASSWORD": "s3kr3t",
... })  # Uses os.environ by default.
>>> cfg
AppConfig(env='dev', lang='C', db=AppConfig.DB(name='default_db', host='localhost', port=5432, user='default_user', password=<SECRET>), awesome=True)
>>> cfg.db.password
's3kr3t'
```

## click **替代Argparse**

- [快速上手](https://www.cnblogs.com/xiao-apple36/p/9089027.html)

Python 内置了一个 Argparse 的标准库用于创建命令行，但使用起来有些繁琐，Click 相比于 Argparse，就好比 requests 相比于 urllib。

常用`click.confirm`:

```py
import click
click.confirm("Do you want to kick this off with an Nmap scan?", default=True):
    dosomething()
```

## shlex **简单词法分析**

- [快速上手](https://docs.python.org/zh-cn/3/library/shlex.html)

常用`shlex.split` 配合`subprocess.run`:
```py
subprocess.run(shlex.split("cat sendtext.txt"), stdout=subprocess.PIPE, universal_newlines=True) 
```

## rich **彩色富文本**

[Rich](https://github.com/Textualize/rich/blob/master/README.cn.md) 是一个 Python 库，可以为您在终端中提供富文本和精美格式。

[Rich API](https://rich.readthedocs.io/en/latest/) 可以很容易的在终端输出添加各种颜色和不同风格。Rich 还可以绘制漂亮的表格，进度条，markdown，突出显示语法的源代码及回溯等等，不胜枚举。

## tabulate **轻松实现字符表格**

- [快速上手](https://python.fasionchan.com/zh_CN/latest/libs/tabulate.html)

```py
>>> from tabulate import tabulate

>>> table_header = ['Name', 'Chinese', 'Math', 'English']
>>> table_data = [
...     ('Tom', '90', '80', '85'),
...     ('Jim', '70', '90', '80'),
...     ('Lucy', '90', '70', '90'),
... ]

>>> print(tabulate(table_data, headers=table_header, tablefmt='grid'))
+--------+-----------+--------+-----------+
| Name   |   Chinese |   Math |   English |
+========+===========+========+===========+
| Tom    |        90 |     80 |        85 |
+--------+-----------+--------+-----------+
| Jim    |        70 |     90 |        80 |
+--------+-----------+--------+-----------+
| Lucy   |        90 |     70 |        90 |
+--------+-----------+--------+-----------+
```

中文对齐引入`import wcwidth`