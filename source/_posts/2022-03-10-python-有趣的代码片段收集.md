---
title: python 有趣的代码片段收集
date: 2022-03-10 14:32:58
tags:
- python
- 收集
- todo
categories:
- 编程
- python
---

本篇为阅读源码时看到的一些有趣的代码，有所改变后记录

## 使用二进制作为选项判断

这是在`Rich`中看到的一段, 用`sum`总和，得到那些参数为真

```py
self._set_attributes = sum(
    (
        bold is not None,
        dim is not None and 2,
        italic is not None and 4,
        underline is not None and 8,
        blink is not None and 16,
        blink2 is not None and 32,
        reverse is not None and 64,
        conceal is not None and 128,
        strike is not None and 256,
        underline2 is not None and 512,
        frame is not None and 1024,
        encircle is not None and 2048,
        overline is not None and 4096,
    )
)
self._attributes = (
    sum(
        (
            bold and 1 or 0,
            dim and 2 or 0,
            italic and 4 or 0,
            underline and 8 or 0,
            blink and 16 or 0,
            blink2 and 32 or 0,
            reverse and 64 or 0,
            conceal and 128 or 0,
            strike and 256 or 0,
            underline2 and 512 or 0,
            frame and 1024 or 0,
            encircle and 2048 or 0,
            overline and 4096 or 0,
        )
    )
```

## 灵活运用or

灵活运用or可以做到参数里面

```py
 render_options = render_options.update_dimensions(
                render_options.max_width, render_options.height or self.height
            )
```

## 使用自定义类来判断是否写了参数

```py
class NoChange:
pass

NO_CHANGE = NoChange()

 def update(
        self,
        *,
        width: Union[int, NoChange] = NO_CHANGE,
        min_width: Union[int, NoChange] = NO_CHANGE
 ):
    if not isinstance(width, NoChange):
        options.min_width = options.max_width = max(0, width)
    if not isinstance(min_width, NoChange):
        options.min_width = min_width
```

## 单行 if...else

```py
print('a') if True else print('b')
```
or 

```py
print('a'
      if True
      else 'b')
``` 

## lambda 作为参数

```py
from typing import Callable

def test_lambda(code: Callable):
    print(type(code))
    if isinstance(code, Callable):
        print("code is callable")
        print(code())

code = 1

test_lambda(code=lambda: str(code or ''))

## output:
#<class 'function'>
#str is callable
#1
```

## print 中的`!r`

```py
pwd='123456'
print(f"password={pwd!r}")

## output:
#password='123456'
```

会将内容用引号包括住
